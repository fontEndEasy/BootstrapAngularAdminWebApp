/*! angular-BMap - v0.0.1 - 2015-06-23 */
!function(a,b){"use strict";function c(){function a(a,c){function d(){return k||(k=new BMap.Map("bMap")),k}function e(){var b=a.defer();return c(function(){d().centerAndZoom(l,14),b.resolve()}),b.promise}function f(){var b=a.defer(),c=new BMap.Geolocation;return c.getCurrentPosition(function(a){this.getStatus()===BMAP_STATUS_SUCCESS?b.resolve(a):b.reject("不能获取位置")},function(a){b.reject("定位失败")}),b.promise}function g(){var b=a.defer();return f().then(function(a){d().panTo(a.point);var c=new BMap.Marker(a.point);d().addOverlay(c),b.resolve(a)},function(a){d().panTo(l);var c=new BMap.Marker(l);d().addOverlay(c),b.reject("定位失败")}),b.promise}function h(e){var f,g,h,i=[],j=a.defer();return c(function(){return e?(b.isArray(e)?e[0].loc?i=e:j.reject("获取不到loc对象信息"):e.loc?i.push(e):j.reject("获取不到loc对象信息"),g=i.length-1,void b.forEach(i,function(a,c){h=c,b.isObject(a.loc)?f=new BMap.Point(a.loc.lng,a.loc.lat):b.isString(a.loc)?f=new BMap.Point(a.loc.split(",")[0],a.loc.split(",")[1]):h="第"+c+"个兴趣点loc对象不存在或格式错误，只支持object和string";var e=new BMap.Marker(f);d().addOverlay(e),j.notify(h),c===g&&j.resolve()})):void j.reject("没有传入兴趣点")}),j.promise}function i(){d().panTo(this.point)}function j(e,f){var g,h,j,k,l=[],m=a.defer();return k=f?f:i,c(function(){return e?(b.isArray(e)?e[0].loc?l=e:m.reject("获取不到loc对象信息"):e.loc?l.push(e):m.reject("获取不到loc对象信息"),h=l.length-1,void b.forEach(l,function(a,c){j=c,b.isObject(a.loc)?g=new BMap.Point(a.loc.lng,a.loc.lat):b.isString(a.loc)?g=new BMap.Point(a.loc.split(",")[0],a.loc.split(",")[1]):j="第"+c+"个兴趣点loc对象不存在或格式错误，只支持object和string";var e=new BMap.Marker(g);e.obj=a,e.addEventListener("click",k),d().addOverlay(e),m.notify(j),c===h&&m.resolve()})):void m.reject("没有传入兴趣点")}),m.promise}var k,l=this.default_position;return{initMap:e,getMap:d,geoLocation:f,geoLocationAndCenter:g,drawMarkers:h,drawMarkersAndSetOnclick:j}}this.default_position=new BMap.Point(118.789572,32.048667),this.setDefaultPosition=function(a,b){return this.default_position=new BMap.Point(a,b),this},this.$get=a,a.$inject=["$q","$timeout"]}function d(a){function b(a,b,c,d){d.initMap(),d.geoLocationAndCenter().then(function(a){console.log(a)},function(a){console.info(a)});var e=[{loc:{lng:121.496011,lat:31.244085}},{lod:"121.494215,31.243005"},{loc:"121.493065,31.244981"},{lod:"121.49691,31.239454"},{loc:"121.502515,31.243622"}];d.drawMarkersAndSetOnclick(e).then(function(a){console.log("兴趣点添加完成")},function(a){console.log(a)},function(a){console.log(a)})}function c(){this.geoLocation=a.geoLocation,this.initMap=a.initMap,this.geoLocationAndCenter=a.geoLocationAndCenter,this.drawMarkers=a.drawMarkers,this.drawMarkersAndSetOnclick=a.drawMarkersAndSetOnclick}return{restrict:"EAC",replace:!0,scope:!0,template:'<div id="bMap" style="height: 100%;"></div>',link:b,controller:c}}var e=b.module("angularBMap",[]);e.provider("angularBMap",c),e.directive("angularBmap",d),d.$inject=["angularBMap"]}(window,window.angular);